# Storage stats

## Introduction

This is a PowerShell script which will generate a report on the capacity utilisation of every storage account in your tenant.

## Report

The final report generated by this script will include the following details about every storage account:
* name of storage account
* SKU of storage account (e.g. `Standard_RAGRS`)
* region (e.g. `ukwest`)
* tier (i.e. hot/cool/cold/archive)
* capacity (measured in GiB)

> [!NOTE]
> This script also assumes you have a tag on every storage account called `CostCenter` and will include the cost center for each storage account as part of the final output. This will allow you to analyse storage utilisation by cost center for more advanced usecases.
>
> You can also change this to some other tag key, depending on your organisation's tagging strategy by modifying the appropriate section of code in the script.


### Example output

The CSV file output will look something like this:

| StorageAccountName | Sku            | Region     | CostCenter    | Tier    | CapacityInGiB |
|--------------------|----------------|------------|---------------|---------|---------------|
| stuajtdrmcpk       | Standard_LRS   | uksouth    | ACMECorp12345 | Hot     | 5             |
| stvizqsdgcjs       | Standard_LRS   | uksouth    | ACMECorp12345 | Cool    | 2             |
| stxezdnupaun       | Standard_LRS   | uksouth    | ACMECorp12345 | Cold    | 6             |
| stwcjlptafhv       | Standard_LRS   | uksouth    | ACMECorp12345 | Archive | 1             |
| stlbdwjefcgq       | Standard_LRS   | uksouth    | ACMECorp12345 | Hot     | 6             |
| stslkjfgahun       | Standard_LRS   | ukwest     | ACMECorp98765 | Cool    | 2             |
| stakhpqsvxca       | Standard_LRS   | ukwest     | ACMECorp98765 | Cold    | 6             |
| staqgrjnubna       | Standard_LRS   | ukwest     | ACMECorp98765 | Archive | 9             |
| stqhrrbvskzc       | Standard_RAGRS | westeurope | ACMECorp98765 | Hot     | 1             |
| stwwcujgvixm       | Standard_RAGRS | westeurope | ACMECorp11234 | Cool    | 7             |

## Access requirements

The script should be run as a principal (e.g. user account or service principal) with a minimum of **Reader** access against the scope you wish to scan for storage accounts (e.g. subscription scope or management group scope).

## Future enhancements

* Investigate ways to gather stats for storage accounts in parallel, rather than one at a time  